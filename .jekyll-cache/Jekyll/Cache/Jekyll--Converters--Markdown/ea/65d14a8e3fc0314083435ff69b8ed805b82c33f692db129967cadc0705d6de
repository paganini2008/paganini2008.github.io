I"“_<p><strong>tridenter</strong>æ˜¯ä¸€æ¬¾åŸºäºSpringBootæ¡†æ¶å¼€å‘çš„å¾®æœåŠ¡åˆ†å¸ƒå¼åä½œæ¡†æ¶ï¼Œå®ƒå¯ä»¥ä½¿å¤šä¸ªç‹¬ç«‹çš„SpringBootåº”ç”¨è½»æ¾å¿«æ·åœ°ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œè€Œä¸ä¾èµ–å¤–éƒ¨çš„æ³¨å†Œä¸­å¿ƒï¼ˆæ¯”å¦‚SpringCloud Eurekaç­‰ï¼‰ã€‚
<strong>tridenter</strong>æ¡†æ¶é¦–å…ˆæä¾›äº†ä¸°å¯Œçš„åˆ†å¸ƒå¼åº”ç”¨é›†ç¾¤ç®¡ç†APIå’Œå·¥å…·ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€å¥—å®Œæ•´çš„å¾®æœåŠ¡æ²»ç†åŠŸèƒ½</p>

<p><strong>tridenterçš„ç‰¹æ€§ï¼š</strong></p>
<ol>
  <li>é‡‡ç”¨å»ä¸­å¿ƒåŒ–çš„æ€æƒ³ç®¡ç†é›†ç¾¤</li>
  <li>æ”¯æŒé›†ç¾¤é—´çš„æ¶ˆæ¯å¤šæ’­å’Œå•æ’­</li>
  <li>æ”¯æŒå„ç§è´Ÿè½½å‡è¡¡ç­–ç•¥</li>
  <li>æ”¯æŒå¤šç§Leaderé€‰ä¸¾ç®—æ³•</li>
  <li>æä¾›è¿›ç¨‹æ± /è°ƒåº¦è¿›ç¨‹æ± çš„å®ç°</li>
  <li>å†…ç½®æ³¨å†Œä¸­å¿ƒ</li>
  <li>å†…ç½®å¤šç§å¾®æœåŠ¡é—´è°ƒç”¨çš„é™æµé™çº§ç­–ç•¥</li>
  <li>å†…ç½®å¾®æœåŠ¡Restå®¢æˆ·ç«¯</li>
  <li>å†…ç½®HTTPæœåŠ¡ç½‘å…³</li>
  <li>é›†ç¾¤çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦</li>
</ol>

<p>é›†ç¾¤ä¸­çš„æ¶ˆæ¯å¤šæ’­æ˜¯tridenteréå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œtridenteråº•å±‚æ˜¯é€šè¿‡Redisï¼ˆPubSubï¼‰å®ç°å¤šæ’­åŠŸèƒ½ä»è€Œå®ç°åº”ç”¨çš„ç›¸äº’å‘ç°çš„ï¼Œè¿›è€Œç»„æˆåº”ç”¨é›†ç¾¤çš„ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½æ”¯æŒæ¶ˆæ¯å¤šæ’­å’Œå•æ’­çš„èƒ½åŠ›ã€‚
åˆ©ç”¨tridenteræ”¯æŒæ¶ˆæ¯å•æ’­çš„èƒ½åŠ›ï¼Œtridenteræä¾›äº†Leaderé€‰ä¸¾ç®—æ³•æ¥å£ï¼Œå†…ç½®äº†ä¸¤ç§Leaderé€‰ä¸¾ç®—æ³•ï¼Œå¿«é€ŸLeaderé€‰ä¸¾ç®—æ³•ï¼ˆåŸºäºRedisé˜Ÿåˆ—ï¼‰å’Œä¸€è‡´æ€§é€‰ä¸¾ç®—æ³•(åŸºäºPaxosç®—æ³•)
åŒæ—¶ï¼Œåˆ©ç”¨tridenteræ”¯æŒæ¶ˆæ¯å•æ’­çš„èƒ½åŠ›ï¼Œtridenteræä¾›äº†è¿›ç¨‹æ± ï¼Œå®ç°äº†è·¨è¿›ç¨‹çš„æ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•åˆ†ç‰‡çš„èƒ½åŠ›
å¦ä¸€æ–¹é¢ï¼Œtridenteræœ¬èº«ä¹Ÿæä¾›äº†å¾®æœåŠ¡æ²»ç†çš„åŸºæœ¬åŠŸèƒ½ï¼š
tridenterè‡ªå¸¦æ³¨å†Œä¸­å¿ƒï¼Œè€Œåˆ©ç”¨æ¶ˆæ¯å¤šæ’­çš„åŸç†ï¼Œåº”ç”¨æ˜¯ç›¸äº’å‘ç°ï¼Œç›¸äº’æ³¨å†Œçš„ï¼Œæ‰€ä»¥é›†ç¾¤ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½æœ‰ä¸€ä»½å…¨é‡çš„æˆå‘˜åˆ—è¡¨ï¼Œå³æ¯ä¸ªåº”ç”¨éƒ½æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä½“ç°äº†å»ä¸­å¿ƒåŒ–çš„è®¾è®¡æ€æƒ³ã€‚æ¯ä¸ªæˆå‘˜é€šè¿‡å‘½åæœåŠ¡ï¼Œå®ç°äº†åº”ç”¨ä¹‹é—´HTTPæ¥å£äº’ç›¸è°ƒç”¨çš„èƒ½åŠ›ï¼Œå¹¶æä¾›äº†ç›¸å…³å„ç§æ³¨è§£å’ŒRestfulé…ç½®å°†æœåŠ¡å‘å¸ƒæ–¹å’Œæ¶ˆè´¹æ–¹è§£è€¦
tridenterè‡ªå¸¦ç½‘å…³åŠŸèƒ½ï¼Œå¯ä»¥å°†åº”ç”¨ç‹¬ç«‹å‘å¸ƒæˆç½‘å…³æœåŠ¡ï¼Œå¯ä»£ç†åˆ†å‘HTTPè¯·æ±‚å’Œä¸‹è½½ä»»åŠ¡ï¼ˆæš‚ä¸æ”¯æŒä¸Šä¼ ï¼‰
tridenterè¿˜å†…ç½®äº†å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•å’Œé™æµé™çº§ç­–ç•¥ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•æˆ–é™çº§ç­–ç•¥
tridenterå®ç°äº†spring actuatorçš„å¥åº·æ£€æŸ¥æ¥å£ï¼Œé™¤äº†ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œè¿˜è‡ªå¸¦æ¥å£çš„ç»Ÿè®¡åˆ†æç­‰åŠŸèƒ½ï¼Œåˆæ­¥å®ç°äº†æ¥å£çš„ç»Ÿä¸€ç®¡ç†å’Œç›‘æ§
æ‰€ä»¥ï¼ŒåŸºäºtridenteræ¡†æ¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ­å»ºä¸€å¥—ç±»ä¼¼äºSpring Cloudçš„å¾®æœåŠ¡ä½“ç³»</p>

<p>tridenteré‡‡ç”¨äº†å»ä¸­å¿ƒåŒ–çš„è®¾è®¡æ€æƒ³ï¼Œå³å¼€å‘äººå‘˜ä¸éœ€è¦çŸ¥é“å½“å‰å“ªä¸ªæ˜¯ä¸»èŠ‚ç‚¹ï¼Œå“ªäº›èŠ‚ç‚¹æ˜¯ä»èŠ‚ç‚¹ï¼Œæ›´ä¸åº”è¯¥æ˜¾å¼åœ°å®šä¹‰æŸä¸ªåº”ç”¨ä¸ºä¸»èŠ‚ç‚¹ï¼Œè¿™æ˜¯ç”±tridenteré‡‡ç”¨çš„Leaderé€‰ä¸¾ç®—æ³•å†³å®šçš„ï¼Œé»˜è®¤çš„é€‰ä¸¾ç®—æ³•æ˜¯å¿«é€Ÿé€‰ä¸¾ç®—æ³•ã€‚æ ¹æ®é€‰ä¸¾ç®—æ³•ï¼Œé›†ç¾¤å†…çš„ä»»æ„ä¸€ä¸ªåº”ç”¨èŠ‚ç‚¹éƒ½æœ‰å¯èƒ½æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªå¯åŠ¨çš„åº”ç”¨å°±æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä½†æ˜¯å¦‚æœé‡‡ç”¨çš„æ˜¯ä¸€è‡´æ€§é€‰ä¸¾ç®—æ³•ï¼Œå¯èƒ½å°±ä¼šä¸ä¸€æ ·ã€‚æ ¹æ®ä½œè€…æè¿°ï¼Œä¸€è‡´æ€§é€‰ä¸¾ç®—æ³•ç›®å‰ä¸ç¨³å®šï¼Œæ¨èåœ¨åº”ç”¨ä¸­ä½¿ç”¨å¿«é€Ÿé€‰ä¸¾ç®—æ³•ã€‚</p>

<p><strong>Maven:</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.github.paganini2008.atlantis<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>tridenter-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.0-RC3<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>
<p>tridenterçš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯è®©ä¸åŒçš„Spring Bootåº”ç”¨å˜æˆé›†ç¾¤æ¨¡å¼ï¼Œæ‰€ä»¥é…ç½®çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦åœ¨application.properties å®šä¹‰ä¸¤ä¸ªç³»ç»Ÿå˜é‡ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">chaconne-management  # æœåŠ¡åç§°</span>
<span class="py">spring.application.cluster.name</span><span class="p">=</span><span class="s">chaconne-management-cluster  #é›†ç¾¤åç§°</span>
</code></pre></div></div>
<p>å¯åŠ¨ä¹‹åï¼Œå¦‚æœåœ¨Consoleçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯åˆ™è¡¨ç¤ºé›†ç¾¤é…ç½®ç”Ÿæ•ˆ</p>
<pre><code class="language-log">2021-06-05 18:20:11 [INFO ] io.undertow - starting server: Undertow - 2.0.29.Final
2021-06-05 18:20:11 [INFO ] org.xnio - XNIO version 3.3.8.Final
2021-06-05 18:20:11 [INFO ] org.xnio.nio - XNIO NIO Implementation Version 3.3.8.Final
2021-06-05 18:20:11 [INFO ] i.a.f.t.m.ApplicationMulticastGroup - Registered candidate: {applicationContextPath: http://192.168.159.1:6543, applicationName: chaconne-management, clusterName: chaconne-management-cluster, id: fafdc9ada3a5d1de3836b1a0ba4ef174, leader: false, startTime: 1622888405582, weight: 1}, Proportion: 1/1
2021-06-05 18:20:11 [INFO ] i.a.f.t.m.ApplicationRegistryCenter - Register application: [{applicationContextPath: http://192.168.159.1:6543, applicationName: chaconne-management, clusterName: chaconne-management-cluster, id: fafdc9ada3a5d1de3836b1a0ba4ef174, leader: false, startTime: 1622888405582, weight: 1}] to ApplicationRegistryCenter
2021-06-05 18:20:11 [INFO ] i.a.f.c.SerialDependencyListener - SerialDependencyHandler initialize successfully.
2021-06-05 18:20:11 [INFO ] i.a.f.t.e.ApplicationLeaderElection - This is the leader of application cluster 'chaconne-management-cluster'. Current application event type is 'indi.atlantis.framework.tridenter.election.ApplicationClusterLeaderEvent'
2021-06-05 18:20:11 [INFO ] i.a.f.t.e.ApplicationLeaderElection - Current leader: {applicationContextPath: http://192.168.159.1:6543, applicationName: chaconne-management, clusterName: chaconne-management-cluster, id: fafdc9ada3a5d1de3836b1a0ba4ef174, leader: true, startTime: 1622888405582, weight: 1}
2021-06-05 18:20:11 [INFO ] o.s.b.w.e.u.UndertowServletWebServer - Undertow started on port(s) 6543 (http) with context path ''
2021-06-05 18:20:12 [INFO ] i.a.f.c.m.ChaconneManagementMain - Started ChaconneManagementMain in 12.134 seconds (JVM running for 12.829)
</code></pre>
<p>é¦–å…ˆï¼š</p>
<pre><code class="language-log">2021-06-05 18:20:11 [INFO ] i.a.f.t.m.ApplicationMulticastGroup - Registered candidate: {applicationContextPath: http://192.168.159.1:6543, applicationName: chaconne-management, clusterName: chaconne-management-cluster, id: fafdc9ada3a5d1de3836b1a0ba4ef174, leader: false, startTime: 1622888405582, weight: 1}, Proportion: 1/1
2021-06-05 18:20:11 [INFO ] i.a.f.t.m.ApplicationRegistryCenter - Register application: [{applicationContextPath: http://192.168.159.1:6543, applicationName: chaconne-management, clusterName: chaconne-management-cluster, id: fafdc9ada3a5d1de3836b1a0ba4ef174, leader: false, startTime: 1622888405582, weight: 1}] to ApplicationRegistryCenter
</code></pre>
<p>è¿™ä¸¤è¡Œæ—¥å¿—åˆ†åˆ«è¡¨ç¤ºæˆåŠŸæ³¨å†Œæ¶ˆæ¯å¤šæ’­ç»„å’Œåº”ç”¨æ³¨å†Œä¸­å¿ƒ</p>

<pre><code class="language-log">2021-06-05 18:20:11 [INFO ] i.a.f.t.e.ApplicationLeaderElection - This is the leader of application cluster 'chaconne-management-cluster'. Current application event type is 'indi.atlantis.framework.tridenter.election.ApplicationClusterLeaderEvent'
2021-06-05 18:20:11 [INFO ] i.a.f.t.e.ApplicationLeaderElection - Current leader: {applicationContextPath: http://192.168.159.1:6543, applicationName: chaconne-management, clusterName: chaconne-management-cluster, id: fafdc9ada3a5d1de3836b1a0ba4ef174, leader: true, startTime: 1622888405582, weight: 1}
</code></pre>
<p>è¿™ä¸¤è¡Œæ—¥å¿—åˆ†åˆ«è¡¨ç¤ºåˆ©ç”¨ApplicationLeaderElectioné€‰ä¸¾ç®—æ³•é€‰å‡ºå½“å‰çš„åº”ç”¨æ˜¯leaderï¼Œï¼ˆå¿«é€Ÿé€‰ä¸¾ç®—æ³•é»˜è®¤å°†ç¬¬ä¸€ä¸ªå¯åŠ¨çš„åº”ç”¨ä½œä¸ºLeader, æœ‰ç‚¹ç±»ä¼¼Jgroupsï¼‰</p>

<p>tridenter-spring-boot-starteræ˜¯ä¸€ä¸ªåŸºç¡€å‹çš„æ¡†æ¶ï¼Œæä¾›äº†å„ç§åˆ†å¸ƒå¼èƒ½åŠ›ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹å‡ ç§èƒ½åŠ›ï¼š</p>
<h3 id="è¿›ç¨‹æ± ">è¿›ç¨‹æ± </h3>
<p>å¤šä¸ªåŒååº”ç”¨ï¼ˆ${spring.application.name}ï¼‰å¯ä»¥ç»„å»ºæˆä¸€ä¸ªè¿›ç¨‹æ± ï¼Œå°±åƒçº¿ç¨‹æ± åˆ†é…ä¸åŒçš„çº¿ç¨‹è°ƒç”¨æŸä¸ªæ–¹æ³•ä¸€æ ·ï¼Œè¿›ç¨‹æ± å¯ä»¥è¿›è¡Œè·¨åº”ç”¨çš„æ–¹æ³•è°ƒç”¨ï¼Œå‰ææ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯å­˜åœ¨çš„</p>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nd">@MultiProcessing</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"calc"</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"11"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">calc</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"a ==&gt; "</span> <span class="o">+</span> <span class="n">a</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"["</span> <span class="o">+</span> <span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">()</span> <span class="o">+</span> <span class="s">"]Port: "</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="s">", Execute at: "</span> <span class="o">+</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
		<span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="mi">20</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@OnSuccess</span><span class="o">(</span><span class="s">"calc"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="nc">Object</span> <span class="n">result</span><span class="o">,</span> <span class="nc">MethodInvocation</span> <span class="n">invocation</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Result: "</span> <span class="o">+</span> <span class="n">result</span> <span class="o">+</span> <span class="s">", Take: "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">invocation</span><span class="o">.</span><span class="na">getTimestamp</span><span class="o">()));</span>
	<span class="o">}</span>

	<span class="nd">@OnFailure</span><span class="o">(</span><span class="s">"calc"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nc">ThrowableProxy</span> <span class="n">info</span><span class="o">,</span> <span class="nc">MethodInvocation</span> <span class="n">invocation</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"========================================"</span><span class="o">);</span>
		<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"{}"</span><span class="o">,</span> <span class="n">info</span><span class="o">);</span>
	<span class="o">}</span>
</code></pre></div></div>
<p>è¯´æ˜ï¼š</p>
<ol>
  <li>æ³¨è§£ @MultiProcessingä¿®é¥°æ–¹æ³•calc, è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•æ˜¯å¤šè¿›ç¨‹è°ƒç”¨çš„</li>
  <li>onSuccesså’ŒonFailureä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„è°ƒç”¨çš„</li>
</ol>

<h3 id="æ–¹æ³•åˆ†ç‰‡">æ–¹æ³•åˆ†ç‰‡</h3>
<p>æ–¹æ³•åˆ†ç‰‡åˆå«æ–¹æ³•å¹¶è¡Œå¤„ç†ï¼Œå…¶å®å°±æ˜¯å°†ä¸€ç»„å‚æ•°çš„æ¯ä¸€ä¸ªå‚æ•°ä½¿ç”¨è¿›ç¨‹æ± åˆ†å‘åˆ°ä¸åŒåº”ç”¨ä¸Šè¿è¡Œï¼Œç„¶åå†åˆå¹¶è¾“å‡ºï¼Œå¹¶éœ€è¦å®ç°åˆ†ç‰‡è§„åˆ™æ¥å£ï¼Œè§æºç ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Parallelization</span> <span class="o">{</span>

	<span class="nc">Object</span><span class="o">[]</span> <span class="nf">slice</span><span class="o">(</span><span class="nc">Object</span> <span class="n">argument</span><span class="o">);</span> <span class="c1">// åˆ‡ç‰‡</span>

	<span class="nc">Object</span> <span class="nf">merge</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">results</span><span class="o">);</span>  <span class="c1">// åˆå¹¶</span>

<span class="o">}</span>
</code></pre></div></div>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@ParallelizingCall</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"loop-test"</span><span class="o">,</span> <span class="n">usingParallelization</span> <span class="o">=</span> <span class="nc">TestCallParallelization</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kt">long</span> <span class="nf">total</span><span class="o">(</span><span class="nc">String</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span><span class="c1">// 0,1,2,3,4,5,6,7,8,9</span>
		<span class="k">return</span> <span class="mi">0L</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TestCallParallelization</span> <span class="kd">implements</span> <span class="nc">Parallelization</span> <span class="o">{</span>

		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="nc">Long</span><span class="o">[]</span> <span class="nf">slice</span><span class="o">(</span><span class="nc">Object</span> <span class="n">argument</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">String</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="o">((</span><span class="nc">String</span><span class="o">)</span> <span class="n">argument</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
			<span class="nc">Long</span><span class="o">[]</span> <span class="n">longArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Long</span><span class="o">[</span><span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
			<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">arg</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">longArray</span><span class="o">[</span><span class="n">i</span><span class="o">++]</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">longArray</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="nc">Long</span> <span class="nf">merge</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
			<span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">Object</span> <span class="n">o</span> <span class="o">:</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">total</span> <span class="o">+=</span> <span class="o">((</span><span class="nc">Long</span><span class="o">)</span> <span class="n">o</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">total</span><span class="o">;</span>
		<span class="o">}</span>

	<span class="o">}</span>
</code></pre></div></div>
<p>è¯´æ˜ï¼š</p>
<ol>
  <li>æ³¨è§£@ParallelizingCallä¿®é¥°totalæ–¹æ³•ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•è¦åšåˆ†ç‰‡å¤„ç†</li>
  <li>å‚æ•°arg, æ¯”å¦‚è¯´ä½ å¯ä»¥ä¼  0,1,2,3,4,5,6,7,8,9ï¼Œåˆ†ç‰‡è§„åˆ™ä¼šè°ƒç”¨sliceæ–¹æ³•å°†å‚æ•°ä»¥â€œ,â€åˆ†å‰²ï¼Œå˜æˆæ•°ç»„ï¼Œç„¶åå°†æ¯ä¸ªå€¼è½¬æ¢æˆlongå‹ï¼Œå†åˆ†å‘åˆ°å„ä¸ªåº”ç”¨æ‰§è¡Œï¼Œå…¨éƒ¨æ‰§è¡Œå®Œäº†ï¼Œå†æ‰§è¡Œmergeæ–¹æ³•è¿›è¡ŒåŠ å’Œæ“ä½œï¼Œæœ‰ç‚¹MapReduceçš„å‘³é“</li>
  <li>totalæ–¹æ³•è¿”å›çš„0ï¼Œæ˜¯æŒ‡å½“å‚æ•°ä¸ºç©ºæˆ–æ–¹æ³•å¼‚å¸¸è¿”å›çš„é»˜è®¤å€¼</li>
</ol>

<h1 id="å¾®æœåŠ¡èƒ½åŠ›">å¾®æœåŠ¡èƒ½åŠ›</h1>
<h3 id="restå®¢æˆ·ç«¯">Restå®¢æˆ·ç«¯</h3>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestClient</span><span class="o">(</span><span class="n">provider</span> <span class="o">=</span> <span class="s">"test-service"</span><span class="o">)</span>
<span class="c1">// @RestClient(provider = "http://192.168.159.1:5050")</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TestRestClient</span> <span class="o">{</span>

	<span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/metrics/sequence/{dataType}"</span><span class="o">)</span>
	<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">sequence</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"dataType"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">dataType</span><span class="o">,</span> <span class="nd">@RequestBody</span> <span class="nc">SequenceRequest</span> <span class="n">sequenceRequest</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>
<p>è¯´æ˜ï¼š</p>
<ol>
  <li>æ³¨è§£@RestClientä¿®é¥°çš„æ¥å£è¯´æ˜è¿™æ˜¯ä¸ªHttpå®¢æˆ·ç«¯</li>
  <li>æ³¨è§£ä¸­ï¼Œproviderå±æ€§è¡¨ç¤ºæœåŠ¡æä¾›æ–¹ï¼Œå¯ä»¥æ˜¯é›†ç¾¤ä¸­çš„æŸä¸ªåº”ç”¨åï¼ˆ${spring.application.name}ï¼‰,ä¹Ÿå¯ä»¥æ˜¯å…·ä½“httpåœ°å€</li>
  <li>æ”¯æŒSpringæ³¨è§£ï¼ˆGetMapping, PostMapping, PutMapping, DeleteMappingï¼‰, æ­¤å¤–ï¼Œç”¨æ³¨è§£@Apiå¯æä¾›æ›´ç»†ç²’åº¦çš„å‚æ•°è®¾ç½®</li>
</ol>

<h3 id="ç½‘å…³">ç½‘å…³</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableGateway</span>
<span class="nd">@SpringBootApplication</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GatewayMain</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">9000</span><span class="o">;</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"server.port"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">port</span><span class="o">));</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">GatewayMain</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>å¼•ç”¨æ³¨è§£@EnableGatewayå°±è¡Œäº†ï¼Œtridenterçš„ç½‘å…³åº•å±‚æ˜¯ç”¨Netty4å®ç°çš„</p>
<h5 id="é…ç½®è·¯ç”±">é…ç½®è·¯ç”±ï¼š</h5>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Primary</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRouterCustomizer</span> <span class="kd">extends</span> <span class="nc">DefaultRouterCustomizer</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">customize</span><span class="o">(</span><span class="nc">RouterManager</span> <span class="n">rm</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">.</span><span class="na">customize</span><span class="o">(</span><span class="n">rm</span><span class="o">);</span>
		<span class="n">rm</span><span class="o">.</span><span class="na">route</span><span class="o">(</span><span class="s">"/my/**"</span><span class="o">).</span><span class="na">provider</span><span class="o">(</span><span class="s">"tester5"</span><span class="o">);</span>
		<span class="n">rm</span><span class="o">.</span><span class="na">route</span><span class="o">(</span><span class="s">"/test/baidu"</span><span class="o">).</span><span class="na">url</span><span class="o">(</span><span class="s">"https://www.baidu.com"</span><span class="o">).</span><span class="na">resourceType</span><span class="o">(</span><span class="nc">ResourceType</span><span class="o">.</span><span class="na">REDIRECT</span><span class="o">);</span>
		<span class="n">rm</span><span class="o">.</span><span class="na">route</span><span class="o">(</span><span class="s">"/test/stream"</span><span class="o">).</span><span class="na">url</span><span class="o">(</span><span class="s">"	https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png"</span><span class="o">).</span><span class="na">resourceType</span><span class="o">(</span><span class="nc">ResourceType</span><span class="o">.</span><span class="na">STREAM</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>
<p>è¯´æ˜ï¼š
ResourceTypeçš„4ç§ç±»å‹ï¼š
DEFAULT,    è½¬å‘è¯·æ±‚
REDIRECT,    è·³è½¬
STREAM,   äºŒè¿›åˆ¶æµ
FILE    ä¿å­˜æ–‡ä»¶</p>

<h3 id="é™æµé™çº§">é™æµé™çº§</h3>
<p>é™æµæ˜¯æŒ‡åœ¨å®¢æˆ·ç«¯é™æµï¼Œè€ŒéæœåŠ¡ç«¯
é™æµä¼šä¾èµ–3ä¸ªæŒ‡æ ‡ï¼š</p>
<ol>
  <li>å“åº”è¶…æ—¶ç‡</li>
  <li>é”™è¯¯ç‡</li>
  <li>å¹¶å‘åº¦
é»˜è®¤æƒ…å†µï¼Œå½“è¿™ä¸‰ä¸ªæŒ‡æ ‡ä¸­æœ‰ä»»ä¸€æŒ‡æ ‡è¶…è¿‡80%ï¼Œå³ä¼šè§¦å‘é™æµï¼Œè°ƒç”¨é™çº§æœåŠ¡
é™æµæŒ‡æ ‡ç»Ÿè®¡ç±» :  RequestStatisticIndicator
é™çº§æœåŠ¡æ¥å£ï¼šFallbackProvider 
ç›¸å…³æºç å¯è‡ªè¡Œç ”ç©¶</li>
</ol>

<h3 id="å¥åº·ç›‘æ§">å¥åº·ç›‘æ§</h3>
<p>ç›®å‰tridenteræä¾›äº†3ä¸ªHealthIndicatorçš„å­ç±»</p>
<ol>
  <li>ApplicationClusterHealthIndicator
 æ˜¾ç¤ºé›†ç¾¤çš„æ•´ä½“å¥åº·çŠ¶æ€</li>
  <li>TaskExecutorHealthIndicator
 æ˜¾ç¤ºé›†ç¾¤çº¿ç¨‹æ± çš„å¥åº·çŠ¶æ€</li>
  <li>RestClientHealthIndicator
 æ˜¾ç¤ºRestå®¢æˆ·ç«¯çš„å¥åº·çŠ¶æ€ï¼ˆå“åº”è¶…æ—¶ç‡ï¼Œé”™è¯¯ç‡ï¼Œå¹¶å‘åº¦ï¼‰</li>
</ol>

<p>æœ€åï¼Œå¾®æœåŠ¡åˆ†å¸ƒå¼åä½œæ¡†æ¶tridenterçš„æºç åœ°å€ï¼šhttps://github.com/paganini2008/tridenter-spring-boot-starter.git</p>
:ET